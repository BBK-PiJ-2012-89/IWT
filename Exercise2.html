<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="file:///H|/public_www/style.css" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Exercise 2</title> 
<script type="text/javascript">
	
	function loadXML(url) {
		
	  if(window.XMLHttpRequest)
	  	{
		xhr=new XMLHttpRequest();
		} 
	else //internet explorer
		{
		xhr=new ActiveXObject("Microsoft.XMLHTTP");
		}
	  xhr.open("GET",url,false);
	  xhr.send("");
	  return xhr.responseXML;
	}
	
	function getThirdLevel(){
		
		var getTheFile = document.getElementById("thirdFile").value;	
		var xmlDoc = loadXML(getTheFile);
		var root = xmlDoc.documentElement;
		var thirdLevel = root.childNodes[1].childNodes;
		var div = document.getElementById("elementArea");
		var elStuff = "<ul>";
		for(var i = 1; i < thirdLevel.length; i = i+2){
			elStuff += "<li>" + thirdLevel[i].nodeName + "</li>";
		}
		elStuff += "</ul>";
		div.removeChild(div.firstChild);
		div.innerHTML+= elStuff;
		return null;
	}
	
	function showXML(){
		
		//get and load xml and xsl files
		var getTheFile = document.getElementById("getAFile").value;		
		var xmlDoc = loadXML(getTheFile);	
		var stylesheet = loadXML("exercise1.xsl");
		
		//retrieve timespan of return table desired
		var beforeAfter = document.getElementById("date");
		var afterBefore = beforeAfter.options[beforeAfter.selectedIndex].value;
		var yearChoice = document.getElementById("year");
		var choiceYear = yearChoice.options[yearChoice.selectedIndex].value;
		
		var yearSort = "*";
		
		//concatenate xpath predicate
		if(yearChoice !="" && beforeAfter !="" && yearChoice !=null && beforeAfter !=null){
			yearSort += "[year" + afterBefore + choiceYear + "]";
		} 
			   
		var table = stylesheet.getElementsByTagName("table");
		
		//Checks if Firefox
		if (document.implementation && document.implementation.createDocument){
			//removing namespaces
  			var nsResolver = stylesheet.createNSResolver(
                   stylesheet.ownerDocument == null ?
                   stylesheet.documentElement :
                   stylesheet.ownerDocument.documentElement);
				   
				   //evaluating stylesheet
 		 	var value = stylesheet.evaluate(
                   "//xsl:sort",
                   stylesheet, nsResolver,
                   XPathResult.ANY_UNORDERED_NODE_TYPE, null);
			
			
			//if the user chose a timespan
			if(yearSort !="*"){
				var yearOrg = table[0].childNodes;
				yearOrg[3].setAttribute("select", yearSort);
			}

		  var proc = new XSLTProcessor();
		  proc.importStylesheet(stylesheet);
		  
		  var resultFragment = proc.transformToFragment(xmlDoc, document);
		  //document.write(yearSort);
		  document.getElementById("tableArea").appendChild(resultFragment);
		  
		 //if using Windows 
		}
	return false;
	}
	
	function populateDropdown(){
		var years = document.getElementById('year');
		var option = document.createElement('option');
		for(var i = 1900; i < 2013; i++){
			option.text = i;
			years.add(new Option(i, i));
		}
	}
		
</script>
</head>

<body onLoad="populateDropdown()">
<div id="thirdLevel">
What File would you like to see the third level Elements of?
<br />
<br />
	<form>
    	<input id="thirdFile" type="text" />
    <input type="button" value="Show Those Kids" onclick="getThirdLevel()"/>
    </form>
</div>
<br />
<br />
<div id="elementArea">
</div>
<br />
<br />
<div id="getFile">
  <form method="post" onSubmit="return showXML()">
    Which XML file should I load?
    <input id="getAFile" type="text">
    <br />
    <br />
    Timespan:   
    <select id="date">
    	<option class="blank"/>
        <option value=">">After</option>
        <option value="<">Before</option>
    </select>
    <select id="year">
    	<option class="blank" ></option>
    </select>
    <br />
    <br />
    Sort By:	
    <select id="sortBy">
    	<option class="blank"/>
    	<option value="year">Year</option>
        <option value="author">Author</option>
        <option value="title">Title</option>
   	</select>
    <br />
    What order would you like? (Separate selections by Commas)
    <input id="columnOrder" type="text">   
    <br />
    <br />
    <br />
    <button type="Submit">Submit</button>
  </form>  
</div>  
<br />
<div id="help"> </div>
<br />
<br />
<div id="tableArea"> </div>
</body>
</html>